<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Telegram Media Downloader - Áèæ‰ª£ÂåñÂ™íÈ´î‰∏ãËºâÁÆ°ÁêÜÂ∑•ÂÖ∑">
  <title>Telegram Media Downloader</title>
  
  <!-- Modern CSS Framework -->
  <link href="{{ url_for('static', filename='css/modern.css') }}?v=2.7.0" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/progress.css') }}?v=2.2.5" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/mobile.css') }}?v=2.2.5" rel="stylesheet">
  
  <!-- Icons -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì•</text></svg>">
</head>

<body>
  <div class="app-container">
    <!-- Compact Navigation Header -->
    <nav class="compact-header">
      <div class="compact-header-left">
        <h1 class="compact-title">üì° TGDL</h1>
        <div class="compact-tabs" data-active-tab="download-manager">
          <button class="compact-tab active" data-tab="download-manager">‰∏ãËºâÁÆ°ÁêÜ</button>
          <button class="compact-tab" data-tab="group-manager">Áæ§ÁµÑÁÆ°ÁêÜ</button>
          <button class="compact-tab" data-tab="fast-test">Âø´ÈÄüÊ∏¨Ë©¶</button>
        </div>
      </div>
      
      <div class="compact-header-right">
        <!-- Session Status -->
        <div id="session-status-indicator" class="compact-status">
          <span class="compact-status-icon" id="session-status-icon">üîÑ</span>
          <span class="compact-status-text" id="session-status-text">Ê™¢Êü•‰∏≠</span>
        </div>
        
        <!-- Action Buttons -->
        <div class="compact-actions">
          <button id="reconnect-btn" class="compact-btn compact-btn-warning" style="display: none;" onclick="forceReconnect()" title="ÈáçÊñ∞ÈÄ£Êé•">
            üîÑ
          </button>
          <button id="global-download-control" class="compact-btn compact-btn-secondary" style="display: none;" onclick="toggleGlobalDownloadState()" title="Êö´ÂÅú‰∏ãËºâ">
            ‚è∏Ô∏è
          </button>
        </div>
        
        <!-- Version -->
        <div class="compact-version">v<span id="app-version">2.2.5</span></div>
      </div>
    </nav>

    <!-- Legacy tabs structure (hidden, for compatibility) -->
    <div class="modern-tabs" style="display: none;">
      <ul class="modern-tabs-nav">
        <li class="modern-tabs-item">
          <a href="#download-manager" class="modern-tabs-link active" data-tab="download-manager">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7,10 12,15 17,10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            ‰∏ãËºâÁÆ°ÁêÜ
          </a>
        </li>
        <li class="modern-tabs-item">
          <a href="#group-manager" class="modern-tabs-link" data-tab="group-manager">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            Áæ§ÁµÑÁÆ°ÁêÜ
          </a>
        </li>
      </ul>
    </div>

    <div class="modern-tabs-content">
      <!-- Download Manager Tab -->
      <div id="download-manager" class="modern-tabs-panel active">
        <!-- Progress Summary Cards -->
        <div class="progress-summary">
          <div class="summary-card summary-card-pending">
            <div class="summary-card-value" id="summary-pending">0</div>
            <div class="summary-card-label">ÂæÖ‰∏ãËºâ</div>
          </div>
          <div class="summary-card summary-card-downloading">
            <div class="summary-card-value" id="summary-downloading">0</div>
            <div class="summary-card-label">‰∏ãËºâ‰∏≠</div>
          </div>
          <div class="summary-card summary-card-completed">
            <div class="summary-card-value" id="summary-completed">0</div>
            <div class="summary-card-label">Â∑≤ÂÆåÊàê</div>
          </div>
          <div class="summary-card summary-card-failed">
            <div class="summary-card-value" id="summary-failed">0</div>
            <div class="summary-card-label">Â§±Êïó</div>
          </div>
        </div>

        <!-- Hidden elements for progress tracking (not visible but needed for data sync) -->
        <div style="display: none;">
          <span id="overall-completed">0</span>
          <span id="overall-total">0</span>
          <span id="overall-speed">0.00 B/s</span>
          <span id="overall-status-text">Ê∫ñÂÇôÈñãÂßã‰∏ãËºâ...</span>
          <div id="overall-progress-bar" style="width: 0%;">
            <div id="overall-progress-text">0%</div>
          </div>
          <span id="concurrent-count">0</span>
          <div id="concurrent-downloads-container"></div>
          <button id="pause-download-btn" style="display: none;"></button>
          <button id="resume-download-btn" style="display: none;"></button>
          <button id="cancel-download-btn" style="display: none;"></button>
        </div>

        <!-- Floating Download Progress Modal -->
        <div class="floating-progress-modal" id="floating-progress-modal" style="display: none;">
          <div class="floating-progress-header">
            <div class="floating-progress-title">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              ‰∏ãËºâÈÄ≤Â∫¶
            </div>
            <div class="floating-progress-controls">
              <button class="floating-btn floating-btn-minimize" onclick="minimizeProgressModal()" title="ÊúÄÂ∞èÂåñ">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </button>
              <button class="floating-btn floating-btn-close" onclick="closeProgressModal()" title="ÈóúÈñâ">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="floating-progress-content">
            <div class="floating-progress-stats">
              <div class="floating-stat-compact">
                <div class="floating-stat-row">
                  <span class="floating-stat-item">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="9,11 12,14 22,4"/>
                    </svg>
                    Â∑≤ÂÆåÊàê <strong id="floating-completed-count">0</strong>
                  </span>
                  <span class="floating-stat-item">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    Ââ©È§ò <strong id="floating-remaining-count">0</strong>
                  </span>
                </div>
                <div class="floating-stat-row">
                  <span class="floating-stat-speed">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="15" x2="12" y2="3"/>
                      <polyline points="8,9 12,5 16,9"/>
                    </svg>
                    <strong id="floating-overall-speed">0.00 B/s</strong>
                  </span>
                </div>
              </div>
            </div>
            
            <div class="floating-progress-bar-container">
              <div class="floating-progress-bar">
                <div class="floating-progress-fill" id="floating-progress-bar" style="width: 0%;">
                  <div class="floating-progress-text" id="floating-progress-text">0%</div>
                </div>
              </div>
            </div>
            
            <div class="floating-progress-actions">
              <button class="floating-action-btn floating-btn-pause" onclick="pauseDownload()" id="floating-pause-btn">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="6" y="4" width="4" height="16"/>
                  <rect x="14" y="4" width="4" height="16"/>
                </svg>
                Êö´ÂÅú
              </button>
              <button class="floating-action-btn floating-btn-resume" onclick="resumeDownload()" id="floating-resume-btn" style="display: none;">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="5,3 19,12 5,21 5,3"/>
                </svg>
                ÁπºÁ∫å
              </button>
              <button class="floating-action-btn floating-btn-cancel" onclick="cancelDownload()" id="floating-cancel-btn">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="15" y1="9" x2="9" y2="15"/>
                  <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
                ÂèñÊ∂à
              </button>
            </div>
            
            <!-- Concurrent Downloads in Floating Modal -->
            <div class="floating-concurrent-section" id="floating-concurrent-section" style="display: none;">
              <div class="floating-concurrent-header">
                <h4 class="floating-concurrent-title">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                  </svg>
                  ‰∏¶Áôº‰∏ãËºâ
                  <span class="floating-concurrent-badge" id="floating-concurrent-count">0</span>
                </h4>
                <button class="floating-btn floating-btn-toggle" onclick="toggleConcurrentSection()" id="concurrent-toggle-btn">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6,9 12,15 18,9"/>
                  </svg>
                </button>
              </div>
              <div class="floating-concurrent-content" id="floating-concurrent-content">
                <div class="floating-concurrent-grid" id="floating-concurrent-container">
                  <!-- Concurrent download items will be added here dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Minimized Progress Indicator -->
        <div class="minimized-progress-indicator" id="minimized-progress-indicator" style="display: none;" onclick="restoreProgressModal()">
          <div class="minimized-progress-content">
            <div class="minimized-progress-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </div>
            <div class="minimized-progress-info">
              <span class="minimized-progress-label">‰∏ãËºâ‰∏≠</span>
              <div class="minimized-progress-bar">
                <div class="minimized-progress-fill" id="minimized-progress-bar" style="width: 0%;"></div>
              </div>
              <span class="minimized-progress-percentage" id="minimized-progress-text">0%</span>
            </div>
          </div>
        </div>

        <!-- Batch Add Download IDs -->
        <div class="glass-card">
          <div class="glass-card-header">
            <h2 class="glass-card-title">ÊâπÈáèÊñ∞Â¢û‰∏ãËºâ‰ªªÂãô</h2>
          </div>
          <div class="glass-card-body">
            <form class="glass-form" id="custom-download-form">
              <div class="glass-form-group">
                <label class="glass-form-label" for="group-select">ÈÅ∏ÊìáÁæ§ÁµÑ</label>
                <select name="chat_id" id="group-select" class="glass-form-select" required>
                  <option value="">Ë´ãÈÅ∏ÊìáÁæ§ÁµÑ...</option>
                </select>
              </div>
              
              <div class="glass-form-group">
                <label class="glass-form-label" for="message-ids">Ë®äÊÅØ ID</label>
                <textarea name="message_ids" id="message-ids" class="glass-form-textarea" 
                  placeholder="Ë´ãËº∏ÂÖ•Ë®äÊÅØIDÔºåÊîØÊè¥‰ª•‰∏ãÊ†ºÂºèÔºö&#10;ÂñÆÂÄãIDÔºö123&#10;Â§öÂÄãIDÔºö123,456,789&#10;ÁØÑÂúçÔºö123-130&#10;Ê∑∑ÂêàÔºö123,456-460,789" 
                  rows="6"></textarea>
                <div class="glass-form-help">
                  ÊîØÊè¥Â§öÁ®ÆÊ†ºÂºèÔºöÂñÆÂÄãID„ÄÅÈÄóËôüÂàÜÈöîÁöÑÂ§öÂÄãID„ÄÅÁØÑÂúçÔºàÂ¶Ç123-130ÔºâÊàñÊ∑∑ÂêàÊ†ºÂºè
                </div>
              </div>
              
              <div class="glass-form-group">
                <div class="flex gap-md">
                  <button type="submit" class="glass-btn glass-btn-primary flex-1">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7,10 12,15 17,10"/>
                      <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Á´ãÂç≥Âä†ÂÖ•‰ΩáÂàó
                  </button>
                  <button type="reset" class="glass-btn glass-btn-secondary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 6h18"/>
                      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                    </svg>
                    Ê∏ÖÁ©∫
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Download History -->
        <div class="glass-card">
          <div class="glass-card-header">
            <h2 class="glass-card-title">‰∏ãËºâÊ≠∑Âè≤ÁÆ°ÁêÜ</h2>
            <div class="glass-card-actions">
              <div class="selected-count-display">
                <span class="selected-count-badge" id="selected-count-badge">
                  Â∑≤ÈÅ∏‰∏≠ <strong id="selected-count">0</strong> ÂÄãÈ†ÖÁõÆ
                </span>
              </div>
              <button class="glass-btn glass-btn-sm glass-btn-secondary" onclick="selectAllTasks()">
                ÂÖ®ÈÅ∏
              </button>
              <button class="glass-btn glass-btn-sm glass-btn-secondary" onclick="deselectAllTasks()">
                ÂèñÊ∂àÂÖ®ÈÅ∏
              </button>
              <button class="glass-btn glass-btn-sm glass-btn-warning" onclick="selectPendingTasks()">
                ÈÅ∏ÊìáÂæÖ‰∏ãËºâ
              </button>
              <button class="glass-btn glass-btn-sm glass-btn-success" onclick="startSelectedDownloads()" id="start-download-btn">
                ‚ñ∂ ÂïüÂãï‰∏ãËºâ
              </button>
              <button class="glass-btn glass-btn-sm glass-btn-info" onclick="cleanDownloadedItems()">
                üßπ Ê∏ÖÁêÜÂ∑≤‰∏ãËºâ
              </button>
              <button class="glass-btn glass-btn-sm glass-btn-danger" onclick="removeSelectedTasks()">
                üóë ÁßªÈô§ÈÅ∏‰∏≠
              </button>
            </div>
          </div>
          <div class="glass-card-body">
            <!-- Filter Toolbar -->
            <div class="history-filter-toolbar">
              <div class="filter-row">
                <div class="filter-controls">
                  <div class="filter-item">
                    <select id="group-filter" class="modern-form-select filter-select">
                      <option value="">üîç ÂÖ®ÈÉ®Áæ§ÁµÑ</option>
                    </select>
                  </div>
                  <div class="filter-item">
                    <select id="status-filter" class="modern-form-select filter-select">
                      <option value="">üìä ÂÖ®ÈÉ®ÁãÄÊÖã</option>
                      <option value="pending">‚è≥ ÂæÖ‰∏ãËºâ</option>
                      <option value="downloading">‚ö° ‰∏ãËºâ‰∏≠</option>
                      <option value="downloaded">‚úÖ Â∑≤‰∏ãËºâ</option>
                      <option value="failed">‚ùå Â§±Êïó</option>
                    </select>
                  </div>
                  <div class="filter-item">
                    <button class="glass-btn glass-btn-sm glass-btn-secondary" onclick="clearFilters()">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 4v6h6"/>
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                      </svg>
                      Ê∏ÖÈô§ÁØ©ÈÅ∏
                    </button>
                  </div>
                </div>
                <div class="filter-stats">
                  <span id="filtered-count" class="stats-badge">
                    üìã È°ØÁ§∫Ôºö0 È†ÖÁõÆ
                  </span>
                  <div class="pagination-controls">
                    <label for="items-per-page">ÊØèÈ†ÅÔºö</label>
                    <select id="items-per-page" class="modern-form-select items-per-page-select">
                      <option value="10">10</option>
                      <option value="20" selected>20</option>
                      <option value="30">30</option>
                      <option value="50">50</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Download History List -->
            <div class="glass-list" id="download-history-list">
              <!-- History items will be dynamically generated here -->
            </div>
            
            <!-- Pagination -->
            <div id="pagination-container" class="flex justify-center mt-lg">
              <!-- Pagination controls will be generated here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Group Manager Tab -->
      <div id="group-manager" class="modern-tabs-panel">
        <!-- Add Group Form -->
        <div class="glass-card">
          <div class="glass-card-header">
            <h2 class="glass-card-title">Êñ∞Â¢ûÁæ§ÁµÑ</h2>
          </div>
          <div class="glass-card-body">
            <form class="glass-form" id="add-group-form">
              <div class="modern-grid modern-grid-2 gap-md">
                <div class="glass-form-group">
                  <label class="glass-form-label" for="new-chat-id">Áæ§ÁµÑ Chat ID</label>
                  <input type="text" name="chat_id" id="new-chat-id" class="glass-form-input" 
                    placeholder="Ëº∏ÂÖ•Áæ§ÁµÑÁöÑ Chat ID" required>
                  <div class="glass-form-help">ÂèØÂú® Telegram ‰∏≠Áç≤ÂèñÁæ§ÁµÑÁöÑÂîØ‰∏Ä ID</div>
                </div>
                
                <div class="glass-form-group">
                  <label class="glass-form-label" for="new-group-name">Áæ§ÁµÑÂêçÁ®±</label>
                  <input type="text" name="name" id="new-group-name" class="glass-form-input" 
                    placeholder="Ëº∏ÂÖ•Áæ§ÁµÑÈ°ØÁ§∫ÂêçÁ®±" required>
                  <div class="glass-form-help">Áî®ÊñºÂú®‰ªãÈù¢‰∏≠È°ØÁ§∫ÁöÑÂèãÂ•ΩÂêçÁ®±</div>
                </div>
              </div>
              
              <div class="glass-form-group">
                <div class="flex gap-md">
                  <button type="submit" class="glass-btn glass-btn-success">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="12" y1="5" x2="12" y2="19"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Êñ∞Â¢ûÁæ§ÁµÑ
                  </button>
                  <button type="button" class="glass-btn glass-btn-secondary" onclick="checkGroupAccess()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M9 12l2 2 4-4"/>
                      <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
                    </svg>
                    Ê™¢Êü•Áæ§ÁµÑÊ¨äÈôê
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Groups List -->
        <div class="glass-card">
          <div class="glass-card-header">
            <h2 class="glass-card-title">Áæ§ÁµÑÁÆ°ÁêÜ</h2>
            <div class="glass-card-actions">
              <button class="glass-btn glass-btn-sm glass-btn-secondary" onclick="selectAllGroups()">ÂÖ®ÈÅ∏</button>
              <button class="glass-btn glass-btn-sm glass-btn-danger" onclick="deleteSelectedGroups()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3,6 5,6 21,6"/>
                  <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6M8,6V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                </svg>
                ÊâπÈáèÂà™Èô§
              </button>
              <button class="glass-btn glass-btn-sm glass-btn-warning" onclick="clearSelectedGroups()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 6h18"/>
                  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                </svg>
                ÊâπÈáèÊ∏ÖÁ©∫
              </button>
            </div>
          </div>
          <div class="glass-card-body">
            <div class="glass-list" id="groups-list">
              <!-- Groups will be dynamically loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Fast Test Tab -->
      <div id="fast-test" class="modern-tabs-panel">
        <!-- Authentication Section (shown when not logged in) -->
        <div id="fast-test-login" class="glass-card" style="display: block;">
          <div class="glass-card-header">
            <h2 class="glass-card-title">üöÄ Âø´ÈÄüÊ∏¨Ë©¶</h2>
            <p class="glass-card-subtitle">ÁôªÂÖ•ÊÇ®ÁöÑ Telegram Â∏≥Ëôü‰ª•ÈñãÂßã‰ΩøÁî®Âø´ÈÄüÊ∏¨Ë©¶ÂäüËÉΩ</p>
          </div>
          <div class="glass-card-body">
            <!-- Login Form -->
            <div id="login-form" class="fast-test-section">
              <div class="glass-form-group">
                <label class="glass-form-label" for="phone-number">ÈõªË©±ËôüÁ¢º</label>
                <input type="tel" id="phone-number" class="glass-form-input" 
                  placeholder="+886912345678" required>
                <div class="glass-form-help">Ë´ãËº∏ÂÖ•ÂÆåÊï¥ÁöÑÂúãÈöõÈõªË©±ËôüÁ¢ºÊ†ºÂºè</div>
              </div>
              <button type="button" id="send-code-btn" class="glass-btn glass-btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m22 2-7 20-4-9-9-4 20-7z"/>
                </svg>
                ÁôºÈÄÅÈ©óË≠âÁ¢º
              </button>
            </div>

            <!-- Code Verification Form -->
            <div id="code-form" class="fast-test-section" style="display: none;">
              <div class="glass-form-group">
                <label class="glass-form-label" for="verification-code">È©óË≠âÁ¢º</label>
                <input type="text" id="verification-code" class="glass-form-input" 
                  placeholder="Ëº∏ÂÖ• Telegram È©óË≠âÁ¢º" required>
                <div class="glass-form-help">Ë´ãÊ™¢Êü•ÊÇ®ÁöÑ Telegram ÊáâÁî®Á®ãÂºè‰ª•Áç≤ÂèñÈ©óË≠âÁ¢º</div>
              </div>
              <div class="flex gap-md">
                <button type="button" id="verify-code-btn" class="glass-btn glass-btn-success">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20,6 9,17 4,12"/>
                  </svg>
                  È©óË≠â
                </button>
                <button type="button" id="back-to-phone-btn" class="glass-btn glass-btn-secondary">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m12 19-7-7 7-7"/>
                    <path d="M19 12H5"/>
                  </svg>
                  ËøîÂõû
                </button>
              </div>
            </div>

            <!-- Password Form (for 2FA) -->
            <div id="password-form" class="fast-test-section" style="display: none;">
              <div class="glass-form-group">
                <label class="glass-form-label" for="two-fa-password">ÂÖ©Ê≠•È©óË≠âÂØÜÁ¢º</label>
                <input type="password" id="two-fa-password" class="glass-form-input" 
                  placeholder="Ëº∏ÂÖ•ÂÖ©Ê≠•È©óË≠âÂØÜÁ¢º" required>
                <div class="glass-form-help">ÊÇ®ÁöÑÂ∏≥ËôüÂ∑≤ÂïüÁî®ÂÖ©Ê≠•È©óË≠âÔºåË´ãËº∏ÂÖ•ÂØÜÁ¢º</div>
              </div>
              <button type="button" id="verify-password-btn" class="glass-btn glass-btn-success">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
                </svg>
                Á¢∫Ë™ç
              </button>
            </div>

            <!-- Status Display -->
            <div id="auth-status" class="fast-test-status" style="display: none;"></div>
          </div>
        </div>

        <!-- Main Interface (shown when logged in) -->
        <div id="fast-test-main" class="fast-test-main" style="display: none;">
          <!-- User Info -->
          <div class="glass-card glass-card-compact">
            <div class="glass-card-body">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-md">
                  <div class="user-avatar">üë§</div>
                  <div>
                    <div class="user-name" id="user-display-name">ËºâÂÖ•‰∏≠...</div>
                    <div class="user-phone" id="user-display-phone"></div>
                  </div>
                </div>
                <div class="flex items-center gap-sm">
                  <button type="button" id="sync-groups-btn" class="glass-btn glass-btn-sm glass-btn-secondary" title="ÂêåÊ≠•Áæ§ÁµÑ">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M23 4v6h-6"/>
                      <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                  </button>
                  <button type="button" id="logout-btn" class="glass-btn glass-btn-sm glass-btn-danger" title="ÁôªÂá∫">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                      <polyline points="16,17 21,12 16,7"/>
                      <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Group Selection -->
          <div class="glass-card">
            <div class="glass-card-header">
              <h3 class="glass-card-title">ÈÅ∏ÊìáÁæ§ÁµÑ</h3>
              <div class="glass-card-actions">
                <button type="button" id="refresh-groups-btn" class="glass-btn glass-btn-sm glass-btn-secondary" title="ÈáçÊñ∞Êï¥ÁêÜ">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6"/>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="glass-card-body">
              <div class="glass-form-group">
                <label class="glass-form-label" for="group-selector">ÈÅ∏ÊìáË¶ÅÁÄèË¶ΩÁöÑÁæ§ÁµÑ</label>
                <select id="group-selector" class="glass-form-select">
                  <option value="">-- Ë´ãÈÅ∏ÊìáÁæ§ÁµÑ --</option>
                </select>
                <div class="glass-form-help">ÈÅ∏ÊìáÁæ§ÁµÑÂæåÂ∞áËºâÂÖ•ÊúÄÊñ∞ÁöÑË®äÊÅØÂÖßÂÆπ</div>
              </div>
              <button type="button" id="load-messages-btn" class="glass-btn glass-btn-primary" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                ËºâÂÖ•Ë®äÊÅØ
              </button>
            </div>
          </div>

          <!-- Messages Display -->
          <div id="messages-container" class="glass-card" style="display: none;">
            <div class="glass-card-header">
              <h3 class="glass-card-title">Ë®äÊÅØÂàóË°®</h3>
              <div class="glass-card-actions">
                <div class="flex items-center gap-sm">
                  <label class="glass-checkbox">
                    <input type="checkbox" id="media-only-filter">
                    <span class="glass-checkbox-mark"></span>
                    ÂÉÖÈ°ØÁ§∫Â™íÈ´î
                  </label>
                  <button type="button" id="select-all-messages" class="glass-btn glass-btn-sm glass-btn-secondary">ÂÖ®ÈÅ∏</button>
                  <button type="button" id="start-download-btn" class="glass-btn glass-btn-sm glass-btn-success" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7,10 12,15 17,10"/>
                      <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    ÈñãÂßã‰∏ãËºâ
                  </button>
                </div>
              </div>
            </div>
            <div class="glass-card-body">
              <div id="selected-count" class="fast-test-status" style="display: none;">
                Â∑≤ÈÅ∏Êìá <span id="selected-count-number">0</span> ÂÄãË®äÊÅØ
              </div>
              <div id="messages-list" class="messages-list">
                <!-- Messages will be loaded here -->
              </div>
              <div id="load-more-container" style="display: none;">
                <button type="button" id="load-more-btn" class="glass-btn glass-btn-secondary glass-btn-full">
                  ËºâÂÖ•Êõ¥Â§öË®äÊÅØ
                </button>
              </div>
            </div>
          </div>

          <!-- Download Progress -->
          <div id="download-progress-container" class="glass-card" style="display: none;">
            <div class="glass-card-header">
              <h3 class="glass-card-title">‰∏ãËºâÈÄ≤Â∫¶</h3>
            </div>
            <div class="glass-card-body">
              <div class="download-summary">
                <div class="download-stat">
                  <span class="download-stat-label">Á∏ΩË®à</span>
                  <span class="download-stat-value" id="total-downloads">0</span>
                </div>
                <div class="download-stat">
                  <span class="download-stat-label">Â∑≤ÂÆåÊàê</span>
                  <span class="download-stat-value" id="completed-downloads">0</span>
                </div>
                <div class="download-stat">
                  <span class="download-stat-label">Â§±Êïó</span>
                  <span class="download-stat-value" id="failed-downloads">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Dependencies -->
  <script src="{{ url_for('static', filename='request/index.js') }}"></script>
  
  <!-- Modern JavaScript Implementation -->
  <script src="{{ url_for('static', filename='js/modern.js') }}"></script>
  
  <script>
    // Initialize icons
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }
    
    // Initialize the modern interface
    document.addEventListener('DOMContentLoaded', function() {
      ModernTelegramDownloader.init();
    });
  </script>
</body>
</html>